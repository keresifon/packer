---
# CIS 2.2 - Special Purpose Services
# Removes unnecessary special purpose services

- name: Remove NIS client
  apt:
    name: nis
    state: absent

- name: Remove rsh client
  apt:
    name: rsh-client
    state: absent

- name: Remove talk client
  apt:
    name: talk
    state: absent

- name: Remove telnet client
  apt:
    name: telnet
    state: absent

- name: Remove LDAP client
  apt:
    name: ldap-utils
    state: absent

# Level 2: Additional service removals
- name: Remove RPC (Level 2)
  apt:
    name: rpcbind
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove Avahi server (Level 2)
  apt:
    name: avahi-daemon
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove CUPS (Level 2)
  apt:
    name: cups
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove DHCP server (Level 2)
  apt:
    name: isc-dhcp-server
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove DNS server (Level 2)
  apt:
    name: bind9
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove FTP server (Level 2)
  apt:
    name: vsftpd
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove HTTP server (Level 2)
  apt:
    name: apache2
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove IMAP and POP3 server (Level 2)
  apt:
    name:
      - dovecot-imapd
      - dovecot-pop3d
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove Samba (Level 2)
  apt:
    name: samba
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove HTTP proxy server (Level 2)
  apt:
    name: squid
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove SNMP server (Level 2)
  apt:
    name: snmpd
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove NIS server (Level 2)
  apt:
    name: nis
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove rsh server (Level 2)
  apt:
    name: rsh-server
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Remove rsync server (Level 2)
  apt:
    name: rsync
    state: absent
  when: (cis_level | default(cis_level_default) | int) >= 2

