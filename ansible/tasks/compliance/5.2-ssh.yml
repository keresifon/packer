---
# CIS 5.2 Compliance Checks - SSH Configuration (Level 2)

- name: Check CIS 5.2.1 - SSH Protocol version (Level 2)
  shell: |
    if grep -q "^Protocol 2" /etc/ssh/sshd_config; then
      echo "PASS"
    else
      echo "FAIL"
    fi
  register: ssh_protocol_check
  failed_when: false
  changed_when: false
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Check CIS 5.2.2 - SSH LogLevel (Level 2)
  shell: |
    if grep -q "^LogLevel INFO" /etc/ssh/sshd_config; then
      echo "PASS"
    else
      echo "FAIL"
    fi
  register: ssh_loglevel_check
  failed_when: false
  changed_when: false
  when: (cis_level | default(cis_level_default) | int) >= 2

- name: Check CIS 5.2.3 - SSH X11Forwarding disabled (Level 2)
  shell: |
    if grep -q "^X11Forwarding no" /etc/ssh/sshd_config; then
      echo "PASS"
    else
      echo "FAIL"
    fi
  register: ssh_x11_check
  failed_when: false
  changed_when: false
  when: (cis_level | default(cis_level_default) | int) >= 2

